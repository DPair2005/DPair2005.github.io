<head>
  <meta charset="UTF-8">
  <link rel="stylesheet" type="text/css" href="/css/main.css">
  <link rel="stylesheet" type="text/css" href="/css/art.css">
  <link rel="icon" type="images/png" href="/images/favicon.png">
  <script src="/js/element.js"></script>
<script src="/js/hitokoto.js"></script>
<script src="/js/search.js"></script>
  <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.2.0/build/styles/atom-one-light.min.css">
  <script src="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.2.0/build/highlight.min.js"></script>
  <script src="/js/language.min.js"></script>
  <title>
    Level Ancestor 的 O(n)-O(1) 解法瞎写 - DPairの非自制 blog
  </title>
</head>

<body>
  <script>
    window.onload = function() {
      loadMath();
      drawSaying();
      hljs.configure({ tabReplace: '  ' });
      hljs.highlightAll()
    }
  </script>

  <div class="content">
    <div class="sidebar" id="sidebar">
      <div class="sidebar-title">
  <p style="font-weight: bold; font-size: 25px; font-family: 'ZCOOL XiaoWei';" onclick="drawSaying()"> 
  DPairの非自制 blog
  </p>
  <hr align="center" style="width: 200px;">
  <p></p>
  <div font style="text-align: center; font-size: 18px; font-family: 'ZCOOL XiaoWei';" class="sayingtype" id="sayingtype"> </div>
  <div font="" style="text-align: center; font-size: 6px;"> 　 </div>
  <div class="saying" id="saying"> </div>
</div>

<script>
  SaveBackground()
</script>

<div class="sidebar-body">

    <div class="sidebar-content">
        <ul class="sidebar-menu">
            <a href="/">
                <li class="list-item sidebar-menu-item" id="sidebar-content-home">
                    Home
                </li>
            </a>
            <a href="/aboutme">
                <li class="list-item sidebar-menu-item" id="sidebar-content-about-me">
                    About Me
                </li>
            </a>
            <a href="/articles">
                <li class="list-item sidebar-menu-item" id="sidebar-content-articles" style="background: #e5e5e5">
                    Articles
                </li>
            </a>
            <a href="/tags">
                <li class="list-item sidebar-menu-item" id="sidebar-content-tags">
                    Tags
                </li>
            </a>
        </ul>
    </div>

    <div class="sidebar-about">
  <div style="text-align: center; font-size: 16px;"> About me </div>
  <HR align="center">
  <div class="avatar-rotate" style="margin: 2 auto; width: min-content">
    <img class="avatar" alt="DPair" src="/images/avatar.png", onclick="NextBackground()">
  </div>

  <ul class="sidebar-links">
  <li class="sidebar-links-item">
    <a href="https://www.luogu.com.cn/blog/DPair2005/" class="friend-link">
      luogu blog 
    </a>
  </li>
<li class="sidebar-links-item">
    <a href="https://codeforces.com/profile/DPair" class="friend-link">
      Codeforces 
    </a>
  </li>
<li class="sidebar-links-item">
    <a href="https://atcoder.jp/users/DPair" class="friend-link">
      AtCoder 
    </a>
  </li>
<li class="sidebar-links-item">
    <a href="https://github.com/DPair2005" class="friend-link">
      github 
    </a>
  </li>
<li class="sidebar-links-item">
    <a href="https://gitee.com/DPair" class="friend-link">
      gitee 
    </a>
  </li>
  </ul>

</div>

<ul class="sidebar-links">
  <div style="text-align: center; font-size: 16px;"> links </div>
  <HR align="center">

  <li class="sidebar-links-item">
    <a href="https://coderoj.gitee.io/" class="friend-link">
      Jacder's blog
    </a>
  </li>
<li class="sidebar-links-item">
    <a href="https://xyix.github.io/" class="friend-link">
      xYix's blog
    </a>
  </li>
<li class="sidebar-links-item">
    <a href="https://www.cnblogs.com/flying2018" class="friend-link">
      flying2018's blog
    </a>
  </li>
<li class="sidebar-links-item">
    <a href="https://www.cnblogs.com/Point-King/" class="friend-link">
      Point_King's blog
    </a>
  </li>
<li class="sidebar-links-item">
    <a href="https://cnblogs.com/pealfrog" class="friend-link">
      xtw's blog
    </a>
  </li>
<li class="sidebar-links-item">
    <a href="https://www.cnblogs.com/zkdxl" class="friend-link">
      zkdxl's blog
    </a>
  </li>
<li class="sidebar-links-item">
    <a href="https://www.cnblogs.com/guts" class="friend-link">
      krimson's blog
    </a>
  </li>
<li class="sidebar-links-item">
    <a href="https://blog.moonpie.cf/" class="friend-link">
      moonpie's blog
    </a>
  </li>
<li class="sidebar-links-item">
    <a href="https://www.luogu.com.cn/blog/wh2005blog/" class="friend-link">
      wuhao2005's blog
    </a>
  </li>
<li class="sidebar-links-item">
    <a href="https://blog.jasonfan.ml/" class="friend-link">
      jasonfan's blog
    </a>
  </li>

</ul>



</div>
    </div>

    <div class="post" id="post">
      <h1>Level Ancestor 的 O(n)-O(1) 解法瞎写</h1>
      <p>学习自 <a href="https://yurzhang.blog.uoj.ac/blog/6589">https://yurzhang.blog.uoj.ac/blog/6589</a></p>
<p>原文中都是写 $\lg$ 的，我按我自己理解写的 $\log$ 不知道对不对（（</p>
<p>说通俗点就是树上 $k$ 级祖先</p>
<p>前面一些部分就跳过了</p>
<hr>
<p>首先我们现在最常用的做法是 $O(n\log n) - O(1)$ 的在线做法</p>
<p>具体方法就是长剖，长剖后在链顶处理出向上向下的信息，并求出每一个点的 $2^k$ 级祖先，最后由于一个点 $k$ 级祖先所在链长一定 $\ge k$ ，因此直接跳就是 $O(1)$ 的</p>
<hr>
<p>我们意识到这东西可以优化</p>
<p>考虑一个点的 $k$ 级祖先就是它子树中某个点的 $k&#39;$ 级祖先，这样说不定可以少求一些东西</p>
<p>考虑以叶子节点为这个 “子树中某个点” ，那么现在就是要 $O(1)$ 求一个叶子的 $k$ 级祖先</p>
<p>看起来没啥优化，但实际上预处理方便了很多</p>
<p>我们发现这道题中倍增数组可以通过维护 dfs栈 实现单点 $O(\log n)$ 的复杂度</p>
<p>看起来似乎是意义不明的操作，事实上当我们只需要求叶子时，假设叶子节点个数是 $L$ ，那么预处理复杂度可以降到 $O(L\log n + n)$</p>
<p>但是这玩意儿还是 $O(n\log n)$ 的，不过我们注意到 $L=O({n\over \log n})$ 的时候这东西就是 $O(n)$</p>
<p><del>是不是想起了某个四毛子</del></p>
<hr>
<p>这部分就是硬核剪枝</p>
<p>想想我们标准 RMQ 是怎么做的？</p>
<p>大范围带 $\log$ 小范围指数级</p>
<p>我们这里也这么干</p>
<p>我们把所有子树大小 $&lt; {\log n\over 4}$ 且父亲节点子树大小 $\ge {\log n\over 4}$ 的子树全部剪下来，剪下来的称为微观树，剩下来的称为宏观树</p>
<p>发现宏观树此时的叶子节点个数是 $O({n\over \log n})$ 的，可以用上面的方法 $O(n)$ 处理</p>
<p>众所周知节点数为 $n$ 的本质不同有根树是 $2^{2n}$ 级别的</p>
<p>因此本质不同的微观树最多 $O(2^{{\log n\over 4}})=O(\sqrt{n})$ 种</p>
<p>考虑每种这里的处理时间是 $O(\log^2 n)$ 的，因此这部分总复杂度是 $O(\sqrt{n}\log^2 n)$</p>
<p>考虑查询</p>
<p>对于宏观树内节点直接查即可</p>
<p>对于一个微观树内节点，如果其 $k$ 级祖先在宏观树内，那么就用宏观树中的对应叶子查，否则直接在微观树内查表，显然都是 $O(1)$ 的</p>
<p>于是得到了一个时空 $O(n)$ 在线 $O(1)$ 查询的算法</p>

      

    </div>

  </div>
</body>