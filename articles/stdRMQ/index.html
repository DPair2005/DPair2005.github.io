<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" type="text/css" href="/css/main.css">
    <link rel="stylesheet" type="text/css" href="/css/art.css">
    <link rel="icon" type="images/png" href="/images/favicon.png">
    <script src="/js/header.js"></script>
<script src="/js/search.js"></script>
<script src="/js/theme.js"></script>
<script src="/js/hitokoto.js"></script>

    <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.2.0/build/styles/atom-one-light.min.css">
    <script src="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.2.0/build/highlight.min.js"></script>
    <script src="/js/language.min.js"></script>
    <title>
        标准 RMQ 算法瞎写 - DPairの非自制 blog
    </title>
</head>

<body>
        <script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script src="/js/load_theme.js"></script>

    <script>
        window.onload = function() {
            loadMath();
            drawSaying();
            hljs.configure({ tabReplace: '    ' });
            hljs.highlightAll()
        }
    </script>

    <div class="content">
        <div class="sidebar" id="sidebar">
            <div class="sidebar-title">
    <p style="font-weight: bold; font-size: 25px; font-family: 'ZCOOL XiaoWei';" onclick="drawSaying()"> 
    DPairの非自制 blog
    </p>
    <hr align="center" style="width: 200px;">
    <p></p>
    <div font style="text-align: center; font-size: 18px; font-family: 'ZCOOL XiaoWei';" class="sayingtype" id="sayingtype"> </div>
    <div font="" style="text-align: center; font-size: 6px;"> 　 </div>
    <div class="saying" id="saying"> </div>
</div>


<div class="sidebar-body">

    <div class="sidebar-content">
        <ul class="sidebar-menu">
            <a href="/">
                <li class="list-item sidebar-menu-item" id="sidebar-content-home">
                    Home
                </li>
            </a>
            <a href="/articles">
                <li class="list-item sidebar-menu-item" id="sidebar-content-articles" style="background: #e5e5e5">
                    Articles
                </li>
            </a>
            <a href="/tags">
                <li class="list-item sidebar-menu-item" id="sidebar-content-tags">
                    Tags
                </li>
            </a>
        </ul>
    </div>

    <div class="sidebar-about">
    <div style="text-align: center; font-size: 16px;">
        <a href="/aboutme" style="text-decoration: none; color: currentColor;">
            About me
        </a>
    </div>
    <HR align="center">
    <div class="avatar-rotate" style="margin: 2 auto; width: min-content">
        <img class="avatar" alt="DPair" src="/images/avatar.png", onclick="NextBackground()">
    </div>

    <ul class="sidebar-links">
    <li class="sidebar-links-item">
        <a href="https://www.luogu.com.cn/blog/DPair2005/" class="friend-link">
            luogu blog 
        </a>
    </li>
<li class="sidebar-links-item">
        <a href="https://codeforces.com/profile/DPair" class="friend-link">
            Codeforces 
        </a>
    </li>
<li class="sidebar-links-item">
        <a href="https://atcoder.jp/users/DPair" class="friend-link">
            AtCoder 
        </a>
    </li>
<li class="sidebar-links-item">
        <a href="https://github.com/DPair2005" class="friend-link">
            github 
        </a>
    </li>
<li class="sidebar-links-item">
        <a href="https://gitee.com/DPair" class="friend-link">
            gitee 
        </a>
    </li>
    </ul>

</div>

<ul class="sidebar-links">
    <div style="text-align: center; font-size: 16px;"> links </div>
    <HR align="center">

    <li class="sidebar-links-item">
        <a href="https://coderoj.gitee.io/" class="friend-link">
            Jacder's blog
        </a>
    </li>
<li class="sidebar-links-item">
        <a href="https://xyix.github.io/" class="friend-link">
            xYix's blog
        </a>
    </li>
<li class="sidebar-links-item">
        <a href="https://www.cnblogs.com/flying2018" class="friend-link">
            flying2018's blog
        </a>
    </li>
<li class="sidebar-links-item">
        <a href="https://www.cnblogs.com/Point-King/" class="friend-link">
            Point_King's blog
        </a>
    </li>
<li class="sidebar-links-item">
        <a href="https://cnblogs.com/pealfrog" class="friend-link">
            xtw's blog
        </a>
    </li>
<li class="sidebar-links-item">
        <a href="http://xyf007.ml/" class="friend-link">
            xyf007's blog
        </a>
    </li>
<li class="sidebar-links-item">
        <a href="https://www.cnblogs.com/zkdxl" class="friend-link">
            zkdxl's blog
        </a>
    </li>
<li class="sidebar-links-item">
        <a href="https://www.cnblogs.com/guts" class="friend-link">
            krimson's blog
        </a>
    </li>
<li class="sidebar-links-item">
        <a href="https://blog.moonpie.cf/" class="friend-link">
            moonpie's blog
        </a>
    </li>
<li class="sidebar-links-item">
        <a href="https://www.luogu.com.cn/blog/wh2005blog/" class="friend-link">
            wuhao2005's blog
        </a>
    </li>
<li class="sidebar-links-item">
        <a href="https://blog.jasonfan.ml/" class="friend-link">
            jasonfan's blog
        </a>
    </li>

</ul>



</div>
        </div>

        <div class="post" id="post">
            <h1>标准 RMQ 算法瞎写</h1>
            <p><strong>upd:感觉之前写的有点问题，于是把所有准确数都加上了 O 符号</strong></p>
<p>瞎写的，有什么问题赶紧来喷我</p>
<p>学习自 <a href="https://ljt12138.blog.uoj.ac/blog/4874">https://ljt12138.blog.uoj.ac/blog/4874</a> ，写的比我不知道高到哪里去了</p>
<p>就是一个严格 $O(n)-O(1)$ RMQ 的东西，不过 OI 中应该没什么用（（</p>
<p>期望 $O(n)-O(1)$ 那个就够了，常数又小又好写又没人卡你</p>
<p>算法流程大概是这样的</p>
<p>首先我们给序列整一个笛卡尔树，这样就把 RMQ 转化成了 LCA 问题</p>
<p>然后我们知道我们可以 RMQ 求 LCA</p>
<p>看到这里你可能觉得建树是意☆义☆不☆明的操作</p>
<p>不过我们看看 LCA 跑 RMQ 的性质，发现我们 RMQ 求 LCA 时是拉出了树的欧拉序</p>
<p>然后发现这东西相邻两个数的差距最多为 $1$</p>
<p>这东西叫做 ±1 RMQ</p>
<p>看到这里你可能觉得这还是意☆义☆不☆明的操作</p>
<p>不过我们发现差分之后，序列本质不同的区间减少了</p>
<p>想想我们期望 $O(n)-O(1)$ RMQ 的做法？那个救爷爷的套路？</p>
<p>不会也不要紧，反正你往下看也能看懂</p>
<p>我们序列分块，块长先整个 $B$</p>
<p>然后我们直接整块序列建 ST表，复杂度 $O(\frac{n}{B}\log n)$</p>
<p>然后我们刚才不是说了？本质不同区间减少了？</p>
<p>发现长度为 $B$ 的本质不同区间就 $O(2^B)$ 个</p>
<p>因此这部分枚举+存在表里面，就可以处理散块查询，配合整块查询可以做到 $O(1)$ 查询</p>
<p>取 $B=O(\log n)$ ，发现上面那一堆都是 $O(n)$</p>
<p>然后我们就得到了 $O(n)-O(1)$ 的 ±1 RMQ，得到了 $O(n)-O(1)$ 的 LCA，得到了 $O(n)-O(1)$ 的标准 RMQ 算法</p>
<hr>
<p><strong>upd：被指出有更好的实现方式，于是就学了学</strong></p>
<p>感谢神仙 @youjiajun</p>
<p><strong>注意：</strong> 这个东西似乎只能在 <strong>块长能压位的范围内有效</strong> ，也就是说大概还有个 $O(\frac{\log n}{w})$ 的东西要乘上去，不过 OI 范围内应该可以忽略不计，本文也这么处理。</p>
<p>大概来说就是这样的</p>
<p>考虑我们还是按 $\log$ 对序列分块，然后之前的方式是通过建笛卡尔树转化成方便压缩的 ±1 RMQ</p>
<p>我们考虑能否直接压缩，仔细想想似乎也是可以的</p>
<p>我们这里以最大值为例</p>
<p>我们考虑对每一个块维护一个栈底到栈顶递减的单调栈，显然到某个数为止时栈内元素就是以当前节点为右端点时，区间最大值的所有可能答案</p>
<p>考虑此时栈内元素可能性只有 $O(2^{\log n})=O(n)$ 种，因此我们以每一个元素与左端点的距离进行状压，然后存在当前点上。</p>
<p>考虑我们只需要知道对于一个确定的右端点，某一个左端点在栈内的后继。</p>
<p>我们用类似压位 Trie 的方法，那么相当于求一个值域为 $O(\log n)$ 级别的后继，由于这里值域小，可以 $O(1)$ 做到</p>
<p>由此散块可以处理，在数据范围小时就是 $O(n)-O(1)$ 的</p>
<p>标准 RMQ 在 OI 中的应用至此已经彻底废掉了（（</p>

            

        </div>

    </div>
</body>