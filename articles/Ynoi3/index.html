<head>
  <meta charset="UTF-8">
  <link rel="stylesheet" type="text/css" href="/css/main.css">
  <link rel="stylesheet" type="text/css" href="/css/art.css">
  <link rel="icon" type="images/png" href="/images/favicon.png">
<script src="/js/element.js"></script>
<script src="/js/hitokoto.js"></script>
<script src="/js/search.js"></script>
  <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@10.4.0/build/styles/atom-one-light.min.css">
  <script src="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@10.4.0/build/highlight.min.js"></script>
  <title>
    Ynoi 做题记录 III - DPairの非自制 blog
  </title>
</head>

<body>
  <script>
    window.onload = function() {
      loadMath();
      drawSaying();
      hljs.configure({ tabReplace: '  ' });
      hljs.initHighlighting()
    }
  </script>

  <div class="content">
    <div class="sidebar" id="sidebar">
      <div class="sidebar-title">
  <p style="font-weight: bold; font-size: 25px; font-family: 'ZCOOL XiaoWei';" onclick="drawSaying()"> 
  DPairの非自制 blog
  </p>
  <hr align="center" style="width: 200px;">
  <p></p>
  <div font style="text-align: center; font-size: 18px; font-family: 'ZCOOL XiaoWei';" class="sayingtype" id="sayingtype"> </div>
  <div font="" style="text-align: center; font-size: 6px;"> 　 </div>
  <div class="saying" id="saying"> </div>
</div>

<script>
  SaveBackground()
</script>

<div class="sidebar-body">

    <div class="sidebar-content">
        <ul class="sidebar-menu">
            <a href="/">
                <li class="list-item sidebar-menu-item" id="sidebar-content-home">
                    Home
                </li>
            </a>
            <a href="/aboutme">
                <li class="list-item sidebar-menu-item" id="sidebar-content-about-me">
                    About Me
                </li>
            </a>
            <a href="/articles">
                <li class="list-item sidebar-menu-item" id="sidebar-content-articles" style="background: #e5e5e5">
                    Articles
                </li>
            </a>
            <a href="/tags">
                <li class="list-item sidebar-menu-item" id="sidebar-content-tags">
                    Tags
                </li>
            </a>
        </ul>
    </div>

    <div class="sidebar-about">
  <div style="text-align: center; font-size: 16px;"> About me </div>
  <HR align="center">
  <div class="avatar-rotate" style="margin: 2 auto; width: min-content">
    <img class="avatar" alt="DPair" src="/images/avatar.png", onclick="NextBackground()">
  </div>

  <ul class="sidebar-links">
  <li class="sidebar-links-item">
    <a href="https://www.luogu.com.cn/blog/DPair2005/" class="friend-link">
      luogu blog 
    </a>
  </li>
<li class="sidebar-links-item">
    <a href="https://codeforces.com/profile/DPair" class="friend-link">
      Codeforces 
    </a>
  </li>
<li class="sidebar-links-item">
    <a href="https://atcoder.jp/users/DPair" class="friend-link">
      AtCoder 
    </a>
  </li>
<li class="sidebar-links-item">
    <a href="https://github.com/DPair2005" class="friend-link">
      github 
    </a>
  </li>
<li class="sidebar-links-item">
    <a href="https://gitee.com/DPair" class="friend-link">
      gitee 
    </a>
  </li>
  </ul>

</div>

<ul class="sidebar-links">
  <div style="text-align: center; font-size: 16px;"> links </div>
  <HR align="center">

  <li class="sidebar-links-item">
    <a href="https://coderoj.gitee.io/" class="friend-link">
      Jacder's blog
    </a>
  </li>
<li class="sidebar-links-item">
    <a href="https://xyix.github.io/" class="friend-link">
      xYix's blog
    </a>
  </li>
<li class="sidebar-links-item">
    <a href="https://www.cnblogs.com/flying2018" class="friend-link">
      flying2018's blog
    </a>
  </li>
<li class="sidebar-links-item">
    <a href="https://www.cnblogs.com/Point-King/" class="friend-link">
      Point_King's blog
    </a>
  </li>
<li class="sidebar-links-item">
    <a href="https://cnblogs.com/pealfrog" class="friend-link">
      xtw's blog
    </a>
  </li>
<li class="sidebar-links-item">
    <a href="https://www.cnblogs.com/zkdxl" class="friend-link">
      zkdxl's blog
    </a>
  </li>
<li class="sidebar-links-item">
    <a href="https://www.cnblogs.com/guts" class="friend-link">
      krimson's blog
    </a>
  </li>
<li class="sidebar-links-item">
    <a href="https://blog.moonpie.cf/" class="friend-link">
      moonpie's blog
    </a>
  </li>
<li class="sidebar-links-item">
    <a href="https://www.luogu.com.cn/blog/wh2005blog/" class="friend-link">
      wuhao2005's blog
    </a>
  </li>
<li class="sidebar-links-item">
    <a href="https://blog.jasonfan.ml/" class="friend-link">
      jasonfan's blog
    </a>
  </li>

</ul>



</div>
    </div>

    <div class="post" id="post">
      <h1>Ynoi 做题记录 III</h1>
      <p>41、<a href="https://www.luogu.com.cn/problem/P7897">P7897 [Ynoi2006] spxmcq</a></p>
<p>标签：扫描线</p>
<p>其实挺套路的。</p>
<p>我们首先考虑设当前的询问是 $x$，然后考虑 $O(nm)$ 的暴力 DP。</p>
<p>发现式子是：</p>
<script type="math/tex; mode=display">
f_u=a_u+x+\sum_{u\to v}\max(f_v, 0)</script><p>然后我们考虑怎么算这个东西。</p>
<p>我们考虑建一个森林。对于每一个原树的状态，只对所有满足 $f_u \ge 0$ 的点连一条连向原树上父亲的边，那么就能得到一个森林。显然我们只会不断加边。</p>
<p>然后我们意识到如果我们对这个森林跑刚才的 DP，只需要这样：</p>
<script type="math/tex; mode=display">
f_u=a_u+x+\sum_{u\to v} f_v</script><p>注意到这个式子就是加上 $x$ 之后的子树和，其实就是这个子树不加 $x$ 的子树和加上 $x$ 乘上子树大小。那么我们只要能够对于每一个 $x$ 快速求出子树形态，基本上就能快速处理这个东西了。</p>
<p>然后我们考虑把 $x$ 递增排序，那么显然 $f_u$ 也是单调递增的。</p>
<p>因此对于每一个点 $\max(f_v, 0)$ 是取 $f_v$ 还是 $0$ 显然只会变化一次。</p>
<p>因此每一条边只会从 <strong>断</strong> 变成 <strong>连</strong> 一次，只要能够快速找到所有这样的边即可。</p>
<p>考虑维护一个 <code>std::set</code>，每一个点对应一个权值 $val$ 表示 $x\ge val$ 时这个点是取 $f_u$ 的，</p>
<p>然后考虑这个 $val$ 是什么，我们显然可以列一个方程：</p>
<script type="math/tex; mode=display">
sz\times val+sum\ge0</script><p>因此</p>
<script type="math/tex; mode=display">
val= \lceil\frac{sum}{sz}\rceil</script><p>其中 $sz, sum$ 分别表示子树大小和子树和。</p>
<p>考虑我们每连一条边，都只会改变集合中 $\mathcal{O}(1)$ 个元素的这两个值，而且在原树上相当于一个链修改。</p>
<p>因此我们再加上一个单点修改区间查询的数据结构就行了。</p>
<p>得到复杂度 $\mathcal{O}((n+m)\log n)$。</p>
<p><del>有没有更优做法我就不知道了，但我确实是压线过去的。</del></p>
<p>42、<a href="https://www.luogu.com.cn/problem/P7898">P7898 [Ynoi2006] wcirq</a></p>
<p>标签：构造？交互？</p>
<p>考虑我们其实就是要设计一个数据结构，使得它恰好覆盖某段区间且支持单点插入。</p>
<p>然后它要保证 Worst Case，说人话就是跑的最慢的一组不能很慢。</p>
<p>还注意到它不支持快速合并。</p>
<p>因此我们毙掉了所有均摊复杂度的数据结构，所有需要快速合并的数据结构。</p>
<p><del>（lxl：这个就是对应 worst case 的带插入区间kth的那个外层平衡树）</del></p>
<p>注意到查询的时候访问的节点数允许达到 $256$，因此想想它是不是会有地方不平衡。</p>
<p>我们这么设计：</p>
<p>首先考虑它要支持的是覆盖区间，因此默认它是一个 leafy 结构，具体是 WBLT 还是 skiplist 什么的再说。</p>
<p>我们暂时假装这个结构是个线段树，那么每一次插入基本上就是 $\mathcal{O}(\log n)$ 级别的，但是有一个问题就是某一个节点内元素过多时要分裂。</p>
<p>我们注意到我们一般均摊的方法都是把后面一次特别久的修改所多花的时间用前面少花的时间去替代。</p>
<p>但是我们这里不能直接均摊复杂度，因此我们要考虑用某种方式，来直接均摊每一次的操作数量。</p>
<p>换言之，对于某一次未来的操作，我们要提前把它给处理掉一部分，这样未来做那一次操作的时候就不至于耗时太久。</p>
<p>这里的这个操作显然就是对于插入过多的节点的分裂操作，我们发现它应该是每 $\mathcal{O}(len)$ 次插入就话费 $\mathcal{O}(len)$ 的代价去重构，因此均摊复杂度是对的。</p>
<p>考虑均摊其操作，假设一个节点长度的上界是 $2u$ 而原长是 $u$，我们可以考虑在它长度为 $1.5u$ 的时候每一次新的操作修改它本身和它未来的左右儿子。</p>
<p>这样就能摊掉一些操作了，这样可能会有</p>
<p><strong>咕咕咕咕咕咕</strong></p>

      

    </div>

  </div>
</body>