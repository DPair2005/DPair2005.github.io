<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" type="text/css" href="/css/main.css">
    <link rel="stylesheet" type="text/css" href="/css/art.css">
    <link rel="icon" type="images/png" href="/images/favicon.png">
    <script src="/js/header.js"></script>
<script src="/js/search.js"></script>
<script src="/js/theme.js"></script>
<script src="/js/hitokoto.js"></script>

    <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.2.0/build/styles/atom-one-light.min.css">
    <script src="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.2.0/build/highlight.min.js"></script>
    <script src="/js/language.min.js"></script>
    <title>
        sqrt tree 瞎写——以 RMQ 为例 - DPairの非自制 blog
    </title>
</head>

<body>
        <script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script src="/js/load_theme.js"></script>

    <script>
        window.onload = function() {
            loadMath();
            drawSaying();
            hljs.configure({ tabReplace: '    ' });
            hljs.highlightAll()
        }
    </script>

    <div class="content">
        <div class="sidebar" id="sidebar">
            <script>
    document.heartland = false;
    window.localStorage.setItem('heartland', false);
</script>

<div class="sidebar-title">
    <p style="font-weight: bold; font-size: 25px; font-family: 'ZCOOL XiaoWei';" onclick="drawSaying()"> 
    DPairの非自制 blog
    </p>
    <hr align="center" style="width: 200px;">
    <p></p>
    <div font style="text-align: center; font-size: 18px; font-family: 'ZCOOL XiaoWei';" class="sayingtype" id="sayingtype"> </div>
    <div font="" style="text-align: center; font-size: 6px;"> 　 </div>
    <div class="saying" id="saying"> </div>
    <div class="sayer" id="sayer"> </div>
</div>

<style>
    .floating-button {
        position: fixed;
        bottom: 15px;
        right: 15px;
        z-index: 100;
        border: none;
        outline: none;
        background-color: cadetblue;
        color: white;
        cursor: pointer;
        padding: 15px;
        border-radius: 50%;
    }
</style>
<button class="floating-button" style="font-family: ZCOOL XiaoWei; font-size:large" onclick="location.href='/milcubes/milcubes.pdf'"">百</button>

<div class="sidebar-body">

    <div class="sidebar-content">
        <ul class="sidebar-menu">
            <a href="/">
                <li class="list-item sidebar-menu-item" id="sidebar-content-home">
                    Home
                </li>
            </a>
            <a href="/articles">
                <li class="list-item sidebar-menu-item" id="sidebar-content-articles" style="background: #e5e5e5">
                    Articles
                </li>
            </a>
            <a href="/tags">
                <li class="list-item sidebar-menu-item" id="sidebar-content-tags">
                    Tags
                </li>
            </a>
        </ul>
    </div>

    <div class="sidebar-about">
    <div style="text-align: center; font-size: 16px;">
        <a href="/aboutme" style="text-decoration: none; color: currentColor;">
            About me
        </a>
    </div>
    <HR align="center">
    <div class="avatar-rotate" style="margin: 2 auto; width: min-content">
        <img class="avatar" alt="DPair" src="/images/avatar.png", onclick="NextBackground()"></img>
    </div>

    <ul class="sidebar-links">
    <li class="sidebar-links-item">
        <a href="https://dpair2005.github.io" class="friend-link">
            github blog 
        </a>
    </li>
<li class="sidebar-links-item">
        <a href="https://dpair.gitee.io" class="friend-link">
            gitee blog 
        </a>
    </li>
<li class="sidebar-links-item">
        <a href="https://www.luogu.com.cn/blog/DPair2005/" class="friend-link">
            luogu blog 
        </a>
    </li>
<li class="sidebar-links-item">
        <a href="https://codeforces.com/profile/DPair" class="friend-link">
            Codeforces 
        </a>
    </li>
<li class="sidebar-links-item">
        <a href="https://atcoder.jp/users/DPair" class="friend-link">
            AtCoder 
        </a>
    </li>
<li class="sidebar-links-item">
        <a href="https://github.com/DPair2005" class="friend-link">
            github 
        </a>
    </li>
<li class="sidebar-links-item">
        <a href="https://gitee.com/DPair" class="friend-link">
            gitee 
        </a>
    </li>
    </ul>

</div>

<ul class="sidebar-links">
    <div style="text-align: center; font-size: 16px;"> links </div>
    <HR align="center">

    <li class="sidebar-links-item">
        <a href="https://coderoj.gitee.io/" class="friend-link">
            Jacder's blog
        </a>
    </li>
<li class="sidebar-links-item">
        <a href="https://xyix.github.io/" class="friend-link">
            xYix's blog
        </a>
    </li>
<li class="sidebar-links-item">
        <a href="https://www.cnblogs.com/flying2018" class="friend-link">
            flying2018's blog
        </a>
    </li>
<li class="sidebar-links-item">
        <a href="https://www.cnblogs.com/Point-King/" class="friend-link">
            Point_King's blog
        </a>
    </li>
<li class="sidebar-links-item">
        <a href="https://cnblogs.com/pealfrog" class="friend-link">
            xtw's blog
        </a>
    </li>
<li class="sidebar-links-item">
        <a href="http://xyf007.ml/" class="friend-link">
            xyf007's blog
        </a>
    </li>
<li class="sidebar-links-item">
        <a href="https://www.cnblogs.com/zkdxl" class="friend-link">
            zkdxl's blog
        </a>
    </li>
<li class="sidebar-links-item">
        <a href="https://www.cnblogs.com/guts" class="friend-link">
            krimson's blog
        </a>
    </li>
<li class="sidebar-links-item">
        <a href="https://blog.moonpie.cf/" class="friend-link">
            moonpie's blog
        </a>
    </li>
<li class="sidebar-links-item">
        <a href="https://www.luogu.com.cn/blog/wh2005blog/" class="friend-link">
            wuhao2005's blog
        </a>
    </li>
<li class="sidebar-links-item">
        <a href="https://blog.jasonfan.ml/" class="friend-link">
            jasonfan's blog
        </a>
    </li>

</ul>



</div>
        </div>

        <div class="post" id="post">
            <h1>sqrt tree 瞎写——以 RMQ 为例</h1>
            <p>感觉猫树白学了</p>
<p><strong>本文纯个人理解 + 口胡，如果有什么问题请往死里喷我</strong></p>
<hr>
<p>我决定从期望 $O(1)$ RMQ 开始说，考虑先对序列分块，块长 $O(\sqrt{n})$ ，然后维护块内前后缀信息和每两个块之间的信息</p>
<p>但是期望 $O(1)$ RMQ 不是有个缺点？</p>
<p>同块的时候是不是会退化成 $O(\sqrt{n})$ ？</p>
<p>那万一有别有用心的人来卡你怎么办？</p>
<p>我们发现我们其实还是在做一段更小区间的 RMQ</p>
<p>因此然后考虑我们 RMQ 是怎么做的</p>
<p>我决定从期望 $O(1)$ RMQ 开始说，考虑先对序列分块，块长 $O(\sqrt{\sqrt{n} })$ ，然后维护块内前后缀信息和每两个块之间的信息</p>
<p>但是期望 $O(1)$ RMQ 不是有个缺点？</p>
<p>同块的时候是不是会退化成 $O(\sqrt{\sqrt{n} })$ ？</p>
<p>那万一有别有用心的人来卡你怎么办？</p>
<p>我们发现我们其实还是在做一段更小区间的 RMQ</p>
<p>因此然后考虑我们 RMQ 是怎么做的</p>
<p>……</p>
<p>然后当序列长度足够小没必要分块的时候，就可以 $O(1)$ 查询的</p>
<p>于是我们得到了一个树形结构，这就是 sqrt tree</p>
<hr>
<p>首先发现这东西层数 $O(\log \log n)$</p>
<p>因此明确其建树是 $O(n\log \log n)$ 的</p>
<p>考虑这里如果直接查询要扫 $O(\log \log n)$ 层直到一个可以 $O(1)$ 的区间</p>
<p>虽然还是期望 $O(1)$ 的（（</p>
<p>但是确实可以被卡到 $O(\log \log n)$ 不是吗（（</p>
<p>想想隔壁猫树是不是也遇到过类似的问题？</p>
<p>可以类似解决吗？</p>
<p>我们照样给它整成 $2^k$ 的形式然后试试能不能二进制</p>
<p>说人话就是所有块长都是 $2^k$ 的形式</p>
<p>那么显然块数也是 $2^k$ 的形式了</p>
<p>不难发现可以用位运算优化这个过程了，具体实现和猫树差不多，留给读者自行思考</p>
<p>不过我个人感觉这里倍增啊二分啊什么的都已经是 $O(\log \log \log n)$ 的了，基本上可以忽略不计了，至于吗（恼</p>
<hr>
<p>考虑修改</p>
<p>隔壁猫树修改比直接重构优秀，看看 sqrt tree 行不行</p>
<p>朴素修改的话显然我们每一层都得重构一个结点，是 $O(n+\sqrt{n}+\sqrt{\sqrt{n}}+\dots)=O(n)$ 的</p>
<p>这不行啊，这怎么能给我们带来笑容呢</p>
<p>此时我们惊讶的发现，我们在原序列上的整块上做的居然也是 RMQ</p>
<p>于是我们再对于整块开一个 sqrt tree ，而不开什么块间的数组了</p>
<p>这样一来复杂度就是 $O(\sqrt{n}+\sqrt{\sqrt{n}}+\dots)=O(\sqrt{n})$ 单次修改了</p>
<hr>
<p>区间修改有两种实现方法</p>
<p>第一种实现是考虑我们区间修改每一层是两个散块，那么就对这 $O(1)$ 个散块暴力重构，复杂度就会多一个 $O(\log \log n)$</p>
<p>第二种实现是给被完整修改的结点全部打上标记，那么修改复杂度不变，查询复杂度由于要查询祖先，就多了一个 $O(\log \log n)$</p>
<hr>
<p>看了一下 OI-wiki 上的代码实现，感觉挺阴间的</p>
<p>口胡了一下可能可以用 ￥gg 论文里面 vEB 树的那种嵌套写法，可能会比 OI-wiki 上的好一些</p>
<p>感觉实战中肯定没什么用，正常人谁闲得无聊写这玩意儿啊</p>

            

        </div>

    </div>
</body>