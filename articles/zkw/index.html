<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" type="text/css" href="/css/main.css">
    <link rel="stylesheet" type="text/css" href="/css/art.css">
    <link rel="icon" type="images/png" href="/images/favicon.png">
    <script src="/js/header.js"></script>
<script src="/js/search.js"></script>
<script src="/js/theme.js"></script>
<script src="/js/hitokoto.js"></script>

    <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.2.0/build/styles/atom-one-light.min.css">
    <script src="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.2.0/build/highlight.min.js"></script>
    <script src="/js/language.min.js"></script>
    <title>
        zkw 线段树瞎写 - DPairの非自制 blog
    </title>
</head>

<body>
        <script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script src="/js/load_theme.js"></script>

    <script>
        window.onload = function() {
            loadMath();
            drawSaying();
            hljs.configure({ tabReplace: '    ' });
            hljs.highlightAll()
        }
    </script>

    <div class="content">
        <div class="sidebar" id="sidebar">
            <script>
    document.heartland = false;
    window.localStorage.setItem('heartland', false);
</script>

<div class="sidebar-title">
    <p style="font-weight: bold; font-size: 25px; font-family: 'ZCOOL XiaoWei';" onclick="drawSaying()"> 
    DPairの非自制 blog
    </p>
    <hr align="center" style="width: 200px;">
    <p></p>
    <div font style="text-align: center; font-size: 18px; font-family: 'ZCOOL XiaoWei';" class="sayingtype" id="sayingtype"> </div>
    <div font="" style="text-align: center; font-size: 6px;"> 　 </div>
    <div class="saying" id="saying"> </div>
</div>

<style>
    .floating-button {
        position: fixed;
        bottom: 15px;
        right: 15px;
        z-index: 100;
        border: none;
        outline: none;
        background-color: cadetblue;
        color: white;
        cursor: pointer;
        padding: 15px;
        border-radius: 50%;
    }
</style>
<button class="floating-button" style="font-family: ZCOOL XiaoWei; font-size:large" onclick="location.href='/milcubes'"">百</button>

<div class="sidebar-body">

    <div class="sidebar-content">
        <ul class="sidebar-menu">
            <a href="/">
                <li class="list-item sidebar-menu-item" id="sidebar-content-home">
                    Home
                </li>
            </a>
            <a href="/articles">
                <li class="list-item sidebar-menu-item" id="sidebar-content-articles" style="background: #e5e5e5">
                    Articles
                </li>
            </a>
            <a href="/tags">
                <li class="list-item sidebar-menu-item" id="sidebar-content-tags">
                    Tags
                </li>
            </a>
        </ul>
    </div>

    <div class="sidebar-about">
    <div style="text-align: center; font-size: 16px;">
        <a href="/aboutme" style="text-decoration: none; color: currentColor;">
            About me
        </a>
    </div>
    <HR align="center">
    <div class="avatar-rotate" style="margin: 2 auto; width: min-content">
        <img class="avatar" alt="DPair" src="/images/avatar.png", onclick="NextBackground()"></img>
    </div>

    <ul class="sidebar-links">
    <li class="sidebar-links-item">
        <a href="https://dpair2005.github.io" class="friend-link">
            github blog 
        </a>
    </li>
<li class="sidebar-links-item">
        <a href="https://dpair.gitee.io" class="friend-link">
            gitee blog 
        </a>
    </li>
<li class="sidebar-links-item">
        <a href="https://www.luogu.com.cn/blog/DPair2005/" class="friend-link">
            luogu blog 
        </a>
    </li>
<li class="sidebar-links-item">
        <a href="https://codeforces.com/profile/DPair" class="friend-link">
            Codeforces 
        </a>
    </li>
<li class="sidebar-links-item">
        <a href="https://atcoder.jp/users/DPair" class="friend-link">
            AtCoder 
        </a>
    </li>
<li class="sidebar-links-item">
        <a href="https://github.com/DPair2005" class="friend-link">
            github 
        </a>
    </li>
<li class="sidebar-links-item">
        <a href="https://gitee.com/DPair" class="friend-link">
            gitee 
        </a>
    </li>
    </ul>

</div>

<ul class="sidebar-links">
    <div style="text-align: center; font-size: 16px;"> links </div>
    <HR align="center">

    <li class="sidebar-links-item">
        <a href="https://coderoj.gitee.io/" class="friend-link">
            Jacder's blog
        </a>
    </li>
<li class="sidebar-links-item">
        <a href="https://xyix.github.io/" class="friend-link">
            xYix's blog
        </a>
    </li>
<li class="sidebar-links-item">
        <a href="https://www.cnblogs.com/flying2018" class="friend-link">
            flying2018's blog
        </a>
    </li>
<li class="sidebar-links-item">
        <a href="https://www.cnblogs.com/Point-King/" class="friend-link">
            Point_King's blog
        </a>
    </li>
<li class="sidebar-links-item">
        <a href="https://cnblogs.com/pealfrog" class="friend-link">
            xtw's blog
        </a>
    </li>
<li class="sidebar-links-item">
        <a href="http://xyf007.ml/" class="friend-link">
            xyf007's blog
        </a>
    </li>
<li class="sidebar-links-item">
        <a href="https://www.cnblogs.com/zkdxl" class="friend-link">
            zkdxl's blog
        </a>
    </li>
<li class="sidebar-links-item">
        <a href="https://www.cnblogs.com/guts" class="friend-link">
            krimson's blog
        </a>
    </li>
<li class="sidebar-links-item">
        <a href="https://blog.moonpie.cf/" class="friend-link">
            moonpie's blog
        </a>
    </li>
<li class="sidebar-links-item">
        <a href="https://www.luogu.com.cn/blog/wh2005blog/" class="friend-link">
            wuhao2005's blog
        </a>
    </li>
<li class="sidebar-links-item">
        <a href="https://blog.jasonfan.ml/" class="friend-link">
            jasonfan's blog
        </a>
    </li>

</ul>



</div>
        </div>

        <div class="post" id="post">
            <h1>zkw 线段树瞎写</h1>
            <p>感觉最近太颓了，要学点亲民的东西，就整了下这个</p>
<p>其实就是非递归的线段树，然后稍微高明一点+卡常一点</p>
<p><strong>可能会有错误，如果发现请往死里喷我</strong></p>
<hr>
<p>先说树的结构</p>
<p>众所周知线段树递归的原因一方面是在于难以确定点的编号，需要每一次重新从根开始搜索然后得到对应点的编号</p>
<p>因此我们要非递归，就要采用一种更为方便处理的编号手段</p>
<p>考虑一般都是用二进制，而这么处理的前置条件就是堆式建树</p>
<p>于是把序列大小先扩到 $2^k$</p>
<p>另外这里扩到 $2^k$ 之前要先把 $n$ 加一，具体原因后面会说</p>
<p><del>日报里直接多扩了一倍我是没想到的</del></p>
<p>那么剩下的点的编号就有很多优美的性质了，一会儿看操作讲</p>
<hr>
<p>首先考虑建树</p>
<p>假设当前树的大小是 $2^{k+1}-1$ </p>
<p>那么发现最后一层的 $2^k$ 个结点刚好就是扩充后的原序列</p>
<p>编号还是连续的，真好</p>
<p>然后考虑 $[1, 2^{k}-1]$ 这些点</p>
<p>显然可以迭代 pushup，就是从 $2^k-1$ 向前循环，然后 pushup 就行</p>
<p>显然这样顺序也是对的</p>
<hr>
<p>然后考虑单点修改</p>
<p>发现一个位置的编号是确定的</p>
<p>发现一个点的父亲结点的编号一定是 $\lfloor{x\over 2}\rfloor$</p>
<p>于是直接确定修改点的位置，然后把所有祖先 pushup 就行</p>
<p>常数小</p>
<hr>
<p>考虑单点查询</p>
<p>没标记的情况下甚至是 $O(1)$ 的</p>
<hr>
<p>考虑区间查询</p>
<p>其实这部分的做法挺高妙的（（</p>
<p>考虑整两个指针，分别指向 $l - 1,r + 1$ 对应的结点（所以序列长度要加 1）</p>
<p>然后这两个指针不断往上跳直到父亲相同</p>
<p>在此之前，我们发现只要左指针的右儿子不是它跳上来的方向，就是我们要的结点</p>
<p>右指针同理</p>
<p>这个画图就能理解</p>
<p>而且这种自底向上的可能可能不访问所有结点</p>
<p>常数又变小了（（</p>
<hr>
<p>区间修改</p>
<p>为了减小常数，考虑使用标记永久化（不然 zkw 线段树就失去意义了？）</p>
<p>显然可以用类似区间查询的方法，而且发现我们所有访问到的结点 pushup 即可</p>
<p>发现最后终止状态时，可能还要往上遍历一些点然后 pushup</p>
<p>这里显然直接跳就行</p>
<p>同理区间查询也得跳到根回收标记</p>
<hr>
<p>空间卡常</p>
<p><strong>这部分多半是口胡的，但感觉挺对的（（</strong></p>
<p>上面说了 zkw 线段树不卡常就失去意义了（？？？）</p>
<p>因此我们继续卡常</p>
<p>我们发现一个性质：<code>t[x] = t[x &lt;&lt; 1] + t[x &lt;&lt; 1 | 1]</code></p>
<p>然后我们有时会打 tag ，又要新的空间</p>
<p>这不好，我们好像没有充分利用空间</p>
<p>发现一个性质，如果我们是 pushdown 式的打标记，那么一个 <strong>有标记</strong> 的结点 pushdown 之后，其儿子的值之和一定变了</p>
<p>因此若 <code>t[x] != t[x &lt;&lt; 1] + t[x &lt;&lt; 1 | 1]</code> 就是没有 pushdown</p>
<p>所以标记可以直接打在结点上（（</p>
<p><del><strong>欢迎各位大佬来卡掉这个东西，卡掉就能出成一道构造 / 提答 / 结论题了</strong></del></p>
<hr>
<p>简单总结一下，上面也说过，这东西除了卡常就没什么用，还不见得有原版线段树好写</p>
<p>实战中一般不会有人特意放 zkw 过然后卡递归线段树</p>
<p><del>感觉实用性甚至不如什么猫树</del></p>
<p>不过思想还可以，值得学学</p>

            

        </div>

    </div>
</body>