<head>
  <meta charset="UTF-8">
  <link rel="stylesheet" type="text/css" href="/css/main.css">
  <link rel="stylesheet" type="text/css" href="/css/art.css">
  <link rel="icon" type="images/png" href="/images/favicon.png">
  <script src="/js/hitokoto.js"></script>
<script src="/js/element.js"></script>
<script src="/js/search.js"></script>
  <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.2.0/build/styles/atom-one-light.min.css">
  <script src="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.2.0/build/highlight.min.js"></script>
  <script src="/js/language.min.js"></script>
  <title>
    猫树瞎写 - DPairの非自制 blog
  </title>
</head>

<body>
  <script>
    window.onload = function() {
      loadMath();
      drawSaying();
      hljs.configure({ tabReplace: '  ' });
      hljs.highlightAll()
    }
  </script>

  <div class="content">
    <div class="sidebar" id="sidebar">
      <div class="sidebar-title">
  <p style="font-weight: bold; font-size: 25px; font-family: 'ZCOOL XiaoWei';" onclick="drawSaying()"> 
  DPairの非自制 blog
  </p>
  <hr align="center" style="width: 200px;">
  <p></p>
  <div font style="text-align: center; font-size: 18px; font-family: 'ZCOOL XiaoWei';" class="sayingtype" id="sayingtype"> </div>
  <div font="" style="text-align: center; font-size: 6px;"> 　 </div>
  <div class="saying" id="saying"> </div>
</div>

<script>
  SaveBackground()
</script>

<div class="sidebar-body">

    <div class="sidebar-content">
        <ul class="sidebar-menu">
            <a href="/">
                <li class="list-item sidebar-menu-item" id="sidebar-content-home">
                    Home
                </li>
            </a>
            <a href="/aboutme">
                <li class="list-item sidebar-menu-item" id="sidebar-content-about-me">
                    About Me
                </li>
            </a>
            <a href="/articles">
                <li class="list-item sidebar-menu-item" id="sidebar-content-articles" style="background: #e5e5e5">
                    Articles
                </li>
            </a>
            <a href="/tags">
                <li class="list-item sidebar-menu-item" id="sidebar-content-tags">
                    Tags
                </li>
            </a>
        </ul>
    </div>

    <div class="sidebar-about">
  <div style="text-align: center; font-size: 16px;"> About me </div>
  <HR align="center">
  <div class="avatar-rotate" style="margin: 2 auto; width: min-content">
    <img class="avatar" alt="DPair" src="/images/avatar.png", onclick="NextBackground()">
  </div>

  <ul class="sidebar-links">
  <li class="sidebar-links-item">
    <a href="https://www.luogu.com.cn/blog/DPair2005/" class="friend-link">
      luogu blog 
    </a>
  </li>
<li class="sidebar-links-item">
    <a href="https://codeforces.com/profile/DPair" class="friend-link">
      Codeforces 
    </a>
  </li>
<li class="sidebar-links-item">
    <a href="https://atcoder.jp/users/DPair" class="friend-link">
      AtCoder 
    </a>
  </li>
<li class="sidebar-links-item">
    <a href="https://github.com/DPair2005" class="friend-link">
      github 
    </a>
  </li>
<li class="sidebar-links-item">
    <a href="https://gitee.com/DPair" class="friend-link">
      gitee 
    </a>
  </li>
  </ul>

</div>

<ul class="sidebar-links">
  <div style="text-align: center; font-size: 16px;"> links </div>
  <HR align="center">

  <li class="sidebar-links-item">
    <a href="https://coderoj.gitee.io/" class="friend-link">
      Jacder's blog
    </a>
  </li>
<li class="sidebar-links-item">
    <a href="https://xyix.github.io/" class="friend-link">
      xYix's blog
    </a>
  </li>
<li class="sidebar-links-item">
    <a href="https://www.cnblogs.com/flying2018" class="friend-link">
      flying2018's blog
    </a>
  </li>
<li class="sidebar-links-item">
    <a href="https://www.cnblogs.com/Point-King/" class="friend-link">
      Point_King's blog
    </a>
  </li>
<li class="sidebar-links-item">
    <a href="https://cnblogs.com/pealfrog" class="friend-link">
      xtw's blog
    </a>
  </li>
<li class="sidebar-links-item">
    <a href="https://www.cnblogs.com/zkdxl" class="friend-link">
      zkdxl's blog
    </a>
  </li>
<li class="sidebar-links-item">
    <a href="https://www.cnblogs.com/guts" class="friend-link">
      krimson's blog
    </a>
  </li>
<li class="sidebar-links-item">
    <a href="https://blog.moonpie.cf/" class="friend-link">
      moonpie's blog
    </a>
  </li>
<li class="sidebar-links-item">
    <a href="https://www.luogu.com.cn/blog/wh2005blog/" class="friend-link">
      wuhao2005's blog
    </a>
  </li>
<li class="sidebar-links-item">
    <a href="https://blog.jasonfan.ml/" class="friend-link">
      jasonfan's blog
    </a>
  </li>

</ul>



</div>
    </div>

    <div class="post" id="post">
      <h1>猫树瞎写</h1>
      <p>处理一类静态区间查询的问题，优势是快速合并</p>
<p>先引入一个例子：区间求和</p>
<p>普及组的小朋友应该都知道这个可以用前缀和+差分处理</p>
<p>然后是 RMQ</p>
<p>也许这东西确实有更低复杂度的做法，但是我们想想能不能也用前缀和类似的方法</p>
<p>这东西的问题在于没法差分</p>
<p>但是众所周知不能减就可以只加不减，和回滚莫队一样</p>
<p>因此类似回滚莫队，选若干个关键点，然后向两边扩展，整一个前缀/后缀最值的数组</p>
<p>不难发现我们选完关键点后，关键点也并不能扩展到整个序列，因此每一个关键点还只能对应一个区间</p>
<p>那么对于一次询问 $[l, r]$ ，我们要找到一个关键点，使得这个关键点对应的区间包含 $[l, r]$ 且这个关键点被 $[l, r]$ 包含</p>
<p>考虑总得有一个区间是 $[1, n]$ ，不难发现若不经过关键点则可以分治下去</p>
<p>因此考虑建一棵线段树，区间就是对应区间，然后中点就是关键点</p>
<p>发现这样每一层都是 $O(n)$ 的，因此预处理是 $O(n\log n)$</p>
<p>然后现在就是要找关键点了</p>
<p>相当于不难发现对于 $[l, r]$ ，其端点对应的两个节点的 LCA 的关键点一定在 $[l, r]$ 间且该区间一定包含 $[l, r]$</p>
<p>因此现在要快速求 LCA</p>
<p>当然你可以 $O(\log n)$ 暴力跳，甚至可以 $O(\log\log n)$ 倍增</p>
<p>不过你还可以堆式建树</p>
<p>具体来说，我们建线段树的时候一个点的两个儿子是 <code>rt * 2, rt * 2 + 1</code></p>
<p>我们发现把最后一层补满之后，这就是一棵完全二叉树，并且可以根据节点编号的 $\log$ 来判断在哪一层，或者具体一点，二进制下长度相同</p>
<p>我们还发现一个点父亲的编号一定是它的一段前缀</p>
<p>因此我们现在要求两个长度相同二进制数的 LCP</p>
<p>直接异或一下就能求出 LCP 长度，然后直接右移即可</p>
<p>这样就能 $O(1)$ 查询了</p>
<hr>
<p>这东西暂时看起来意义不明</p>
<p>不过我们实操中有些东西不能 $O(1)$ 合并</p>
<p>发现猫树的合并次数是 $O(n\log n)-O(1)$ 的</p>
<p>因此在合并难度大的一些题目中会有用</p>
<p>最典型就是线性基</p>
<hr>
<p>猫树的单点修改显然是 $O(n)$ 的</p>
<p>不难理解，每一层都是一个节点，然后每过一层规模减半，最后还是 $O(n)$</p>
<p>考虑区间修改，例如区间加然后 RMQ</p>
<p>洛谷的猫树日报中说是 $O(n\log n)$ 的，因为要重构</p>
<p>不过我个人觉得，如果能打标记的话应该是可以 $O(n)$ 的</p>
<p><strong>这里要是错了就赶紧来喷我</strong></p>
<p>考虑对于被完整修改的节点我们打标记</p>
<p>不能完整修改的节点每一层最多两个，也是 $O(1)$</p>
<p>因此还是 $O(n)$</p>
<hr>
<p>猫树可以用在序列长度短的题目中</p>
<p>不过仔细想想，那个 $O(n)-O(1)$ RMQ 也挺够用的</p>
<p>再仔细想想，这东西再 RMQ 上其实和 ST表差别也不大</p>
<p>所以估计正式比赛中没什么用（（</p>

      

    </div>

  </div>
</body>